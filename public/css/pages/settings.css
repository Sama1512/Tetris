/* ===== 全体レイアウト共通設定 ===== */
body.settings {
  margin: 0;
  padding: 40px 0;
  overflow-x: hidden;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  box-sizing: border-box;
}

/* ===== 設定フォーム全体 ===== */
#settings-form {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 800px;
  padding: 0 1rem;
  box-sizing: border-box;
}

/* ===== タブ内コンテンツ全体 ===== */
.tab-content {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  box-sizing: border-box;
}

/* ===== キー設定：2列表示用グリッド ===== */
.key-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
  width: 100%;
  max-width: 700px;
  box-sizing: border-box;
  margin: 0 auto;
}

/* ===== 設定1行（共通） ===== */
.setting-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.8rem;
  margin-bottom: 12px;
  width: 100%;
  max-width: 600px;
  box-sizing: border-box;
}

/* ===== キー設定専用：1行に2組（ラベル＋インプット） ===== */
.setting-row.setting-keys {
  justify-content: space-between;
  gap: 2rem;
  flex-wrap: wrap;
}

.setting-row.setting-keys .pair {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  min-width: 270px;
  justify-content: flex-end;
}

/* ===== 各タブに対応するラベル設定 ===== */
#tab-keys .pair label {
  display: inline-block;
  width: 8em;
  text-align: right;
  font-weight: bold;
  white-space: nowrap;
}

#tab-display .setting-row > label {
  display: inline-block;
  width: 15em;
  text-align: right;
  font-weight: bold;
  white-space: nowrap;
}

#tab-control .setting-row > label {
  display: inline-block;
  width: 10em;
  text-align: right;
  font-weight: bold;
  white-space: nowrap;
}

/* ===== 入力欄 ===== */
.setting-row input[type="text"],
.setting-row input[type="number"],
.setting-row select {
  padding: 6px 10px;
  width: 140px;
  max-width: 140px;
  text-align: center;
  font-size: 1rem;
  box-sizing: border-box;
  display: inline-block;
}

/* ===== トグルボタン（中央見せ） ===== */
input[type="checkbox"].toggle {
  appearance: none;
  width: 50px;
  height: 26px;
  background: #555;
  border-radius: 13px;
  position: relative;
  cursor: pointer;
  transition: background 0.3s;
  display: inline-block;
  vertical-align: middle;
}

input[type="checkbox"].toggle::before {
  content: '';
  position: absolute;
  top: 3px;
  left: 4px;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  transition: transform 0.3s;
}

input[type="checkbox"].toggle:checked {
  background: #007bff;
}

input[type="checkbox"].toggle:checked::before {
  transform: translateX(22px);
}

/* ===== ボタン行 ===== */
.button-row {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 20px;
  flex-wrap: wrap;
}

/* ===== モバイル対応（500px以下） ===== */
@media (max-width: 500px) {
  .key-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .setting-row {
    flex-direction: column;
    align-items: flex-start;
  }

  #tab-keys .pair label,
  #tab-display .setting-row > label,
  #tab-control .setting-row > label {
    width: 100%;
    text-align: left;
    margin-bottom: 4px;
  }

  .setting-row input,
  .setting-row select,
  input[type="checkbox"].toggle {
    width: 100%;
    max-width: 100%;
    margin: 0;
  }

  input[type="checkbox"].toggle::before {
    left: 3px;
    width: 18px;
    height: 18px;
  }

  input[type="checkbox"].toggle:checked::before {
    transform: translateX(20px);
  }
}

/* テーマ/音の2カラム整列 */
.settings .setting-theme,
.settings .setting-sound,
.settings .setting-effects {
  display:grid;
  grid-template-columns: 160px 1fr;
  gap:12px;
  align-items:center;
  max-width:720px;
}
.settings .setting-effects .pair{
  display:grid;
  grid-template-columns: 120px 1fr;
  gap:8px;
  align-items:center;
}
#sfx-volume{ width:min(320px, 40vw); }

/* ボタンは常に前面（キャラに隠れないように） */
.settings .button-row{ position:relative; z-index:99999; pointer-events:auto; }
.settings .save-button, .settings .return-button{ pointer-events:auto; }

/* === Saveボタンのミニバッジ（レイアウト非干渉） === */
#save-btn { position: relative; overflow: visible; }

#save-btn.saved::after,
#save-btn.autosaved::after {
  content: "✓ 保存しました";
  position: absolute;
  left: 50%;
  top: -8px;                 /* ボタンのちょい上に出す */
  transform: translate(-50%, -100%) scale(.9);
  background: rgba(0, 179, 126, .95); /* 目に優しい緑 */
  color: #fff;
  font-weight: 700;
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  box-shadow: 0 8px 20px rgba(0,0,0,.25);
  opacity: 0;
  pointer-events: none;
  animation: saveFlash .9s ease-out forwards;
  z-index: 2147483647;       /* なんぼでも前面 */
}

@keyframes saveFlash {
  0%   { opacity: 0; transform: translate(-50%, -120%) scale(.85); }
  20%  { opacity: 1; transform: translate(-50%, -105%) scale(1); }
  80%  { opacity: 1; }
  100% { opacity: 0; transform: translate(-50%, -120%) scale(.95); }
}

/* ==== テーマ/音タブの見直し（横スクロール撲滅＆整列） ==== */

/* ページ内の横スクロールは発生させない（内側で完結） */
.tab-container, .tab-content { overflow-x: clip; }   /* clip=隠す。hiddenでもOK */
#tab-theme { width: 100%; }

/* “最小幅0”を明示してグリッド項目のはみ出しを防ぐ（横スク原因TOP3） */
.settings .setting-theme,
.settings .setting-sound,
.settings .setting-effects,
.settings .setting-effects .pair,
.settings input,
.settings select { min-width: 0; }

/* ラベルと入力の横並びを統一。幅は 160px : 自動 : 右端(値) の3カラム */
.settings .setting-theme,
.settings .setting-sound {
  display: grid;
  grid-template-columns: 160px 1fr auto;  /* ラベル / 入力 / 付帯（%表示など） */
  gap: 12px;
  align-items: center;
  width: 100%;
  max-width: 720px;   /* 画面に応じて適度に収まる上限 */
  margin: 8px auto;
}

/* ラベルは右寄せ（読みやすい） */
.settings .setting-theme > label,
.settings .setting-sound  > label[for] {
  justify-self: end;
  white-space: nowrap;
}

/* “ミュート”みたいに <label><input>… の1要素だけの行は、右2カラムに展開して左寄せ */
.settings .setting-sound > label:not([for]) {
  grid-column: 2 / span 2;               /* 2〜3列目を占有 */
  justify-self: start;
  display: flex; align-items: center; gap: 10px;
}

/* スライダーの幅は画面に合わせて伸縮（オーバーフローしない） */
#sfx-volume,
#effects-badge-scale {
  width: clamp(240px, 50vw, 520px);
  max-width: 100%;
}

/* スライダー右の数値は3列目に。最小幅を確保して崩れにくく */
#sfx-volume-out,
#effects-badge-scale-out {
  grid-column: 3;
  justify-self: start;
  min-width: 3ch;
  text-align: left;
}

/* テーマのセレクトも自然に広がるが、はみ出さない */
#theme-select { max-width: 100%; }

/* 演出（fieldset）は見出し付きのカード風に。中身は3カラムグリッドで統一 */
.settings .setting-effects {
  display: grid;
  grid-template-columns: 160px 1fr auto;
  gap: 12px;
  align-items: center;
  width: 100%;
  max-width: 720px;
  margin: 12px auto;
  padding: 12px 14px 14px;
  border: 1px solid var(--border-color, #666);
  border-radius: 10px;
}

/* legendの少しだけ強調 */
.settings .setting-effects > legend {
  padding: 0 8px;
  font-weight: 700;
  letter-spacing: .02em;
}

/* 「演出を表示」チェックは右2カラムへ置く（ミュートと同じ動き） */
.settings .setting-effects > label {
  grid-column: 2 / span 2;
  justify-self: start;
  display: flex; align-items: center; gap: 10px;
}

/* .pair はコンテンツ化（親グリッドに直接並べる） */
.settings .setting-effects .pair { display: contents; }

/* .pair 内ラベルは1列目へ、値や入力は2〜3列目へ */
.settings .setting-effects .pair > label {
  grid-column: 1;
  justify-self: end;
  white-space: nowrap;
}
#effects-badge-scale   { grid-column: 2; }
#effects-badge-scale-out { grid-column: 3; }

/* 連続表示ラベルの入力は2列目を広く使う */
#combo-label {
  grid-column: 2 / span 2;
  width: clamp(220px, 40vw, 340px);
  max-width: 100%;
}

/* モバイル時は縦積み（読みやすさ優先） */
@media (max-width: 600px) {
  .settings .setting-theme,
  .settings .setting-sound,
  .settings .setting-effects {
    grid-template-columns: 1fr;     /* 1カラム */
  }
  .settings .setting-theme > label,
  .settings .setting-sound  > label[for],
  .settings .setting-effects .pair > label {
    justify-self: start;
  }
  #sfx-volume,
  #effects-badge-scale {
    width: 100%;
  }
  #sfx-volume-out,
  #effects-badge-scale-out {
    grid-column: 1;
    justify-self: end;
  }
}

/* テーマ/音タブの時だけページスクロールを止める */
body.settings.no-page-scroll {
  overflow: hidden !important;
  height: 100dvh;
}

/* 非表示タブは確実に隠す（hidden属性対応・保険）*/
.tab-content[hidden] { display: none !important; }

/* 非表示タブは完全に隠す（保険） */
.tab-content[hidden] { display: none !important; }

/* ← NEW: テーマ/音タブのときは “ページ全体” のスクロールを止める（htmlも対象） */
html.no-scroll-root,
body.settings.no-page-scroll {
  overflow: hidden !important;
  height: 100svh;     /* iOS/Android対策。fallback が要るなら下2行を追加 */
  height: 100dvh;
  height: 100vh;
  overscroll-behavior: none;    /* バウンス抑止 */
}

/* ← NEW: 念のためテーマパネル側も内側スクロールを発生させない */
#tab-theme {
  overflow-y: clip !important;  /* hidden 相当（スクロール不可 & バー非表示） */
  max-height: none !important;
}

/* 見た目だけバーを消したい（スクロールは残す）場合の保険：必要なら有効化
html.no-scroll-root { scrollbar-width: none; }
html.no-scroll-root::-webkit-scrollbar { display: none; }
*/